<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Pitch.js Example</title>
    <!-- <script src="https://cdn.jsdelivr.net/npm/@mikolajblaszczyk/pitchfinder@1.2.0/dist/pitchfinder.min.js"></script> -->
    
  </head>
  <body>
    <style>
        #show{
            border: 2px solid brown;
            width: 200px;
            height: 150px;
        }
    </style>
    <h1>Pitch.js Example</h1>
    <div id="show"></div>
    <script>
        // Tworzenie kontekstu AudioContext
        const wynikiDiv = document.getElementById("show");
       const AudioContext = window.AudioContext || window.webkitAudioContext;
       const audioContext = new AudioContext();

       
   
       // Uzyskiwanie dostępu do urządzenia mikrofonu
       navigator.mediaDevices.getUserMedia({ audio: true })
       .then((stream) => {
           // Tworzenie źródła dźwięku z mediów strumieniowych
           const source = audioContext.createMediaStreamSource(stream);
           
           // Tworzenie analizatora częstotliwości
           const analyser = audioContext.createAnalyser();
           analyser.fftSize = 2048;
           
           // Podłączanie źródła dźwięku do analizatora częstotliwości
           source.connect(analyser);
           
           // Tworzenie bufora o rozmiarze wynikającym z fftSize analizatora
           const bufferLength = analyser.frequencyBinCount;
           const dataArray = new Float32Array(bufferLength);
           
           // Funkcja wywoływana co pewien czas, która odczytuje dane z analizatora częstotliwości
           function update() {
           analyser.getFloatFrequencyData(dataArray);
           
           // Obliczanie częstotliwości dźwięków
           const maxIndex = dataArray.indexOf(Math.max(...dataArray));
           const frequency = audioContext.sampleRate * maxIndex / bufferLength;
           
           console.log(frequency);
           wynikiDiv.innerHTML = frequency;

           
           requestAnimationFrame(update);
           }
           
           // Rozpoczęcie odświeżania danych z analizatora częstotliwości
           requestAnimationFrame(update);
       })
       .catch((error) => {
           console.error(error);
       });

       </script>
  </body>
</html>

